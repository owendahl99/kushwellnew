    {# FILE: app/templates/base.html #}
    <!DOCTYPE html>
    <html lang="en">
    <head>
      <!-- Charset must be in <head> -->
      <meta charset="utf-8">
      
      <!-- Viewport meta -->
      <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">

      {# CSRF token for AJAX/forms #}
      <meta name="csrf-token" content="{{ csrf_token() }}">

      <title>{% block title %}Kushwell{% endblock %}</title>

      {# Cache-busted CSS #}
      <link rel="stylesheet" href="{{ url_for('static', filename='css/kushwell.css', v=ASSET_VER) }}">
      <link rel="stylesheet" href="{{ url_for('static', filename='css/control.css', v=ASSET_VER) }}">

  
      {# Chalk fonts #}
      <link href="https://fonts.googleapis.com/css2?family=Cabin+Sketch:wght@700&family=Kalam:wght@400;700&display=swap" rel="stylesheet">

      <style>
        :root {
          --kw-bg:#0b1c14; --kw-bg-2:#0f271f;
          --kw-ink:#e7f3ec; --kw-ink-dim:#cfe0d7;
          --kw-accent:#f5d547; --kw-border:#2a6c50;
          --kw-line:#355f4c;
        }
        html, body { height: 100%; margin: 0; }

        body.kw-body.theme-chalk {
          background:
            var(--kw-bg)
            url('{{ url_for("static", filename="img/chalkboard.jpg", v=ASSET_VER|default(1)) }}')
            no-repeat center center fixed !important;
          background-size: cover !important;
          color: var(--kw-ink);
          font-family: system-ui, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
          line-height: 1.55;
        }

        main, .kw-shell, .page-section, .section, section[aria-label] {
          background: transparent !important;
        }

        .kw-shell { max-width: 1200px; margin: 0 auto; padding: 12px; }

        h1.kw-h1 {
          font-family: "Cabin Sketch", system-ui, Segoe UI, Roboto, Arial, sans-serif;
          font-weight: 700;
          font-size: clamp(2rem, 4.5vw, 3rem);
          line-height: 1.06;
          color: #f8f8f8;
          letter-spacing: .5px;
          text-shadow: 0 1px 0 rgba(0,0,0,.35), 0 0 24px rgba(255,255,255,.06);
          margin: 0 0 .3em;
        }

        .kw-hero__desc {
          font-family: "Kalam", system-ui, Segoe UI, Roboto, Arial;
          font-weight: 700;
          font-size: clamp(1.05rem, 2.2vw, 1.2rem);
          color: #eaeaea;
          letter-spacing: .2px;
          margin: .2em 0 .8em;
        }

        .kw-link {
          color: #fdf7b3;
          text-decoration: underline;
          text-underline-offset: 2px;
        }
        .kw-link:focus-visible {
          outline: 3px solid #fdf7b3;
          outline-offset: 2px;
          border-radius: 6px;
        }
      </style>

      {% block extra_head %}{% endblock %}
    </head>

    <body class="{% block body_class %}kw-body theme-chalk{% endblock %}">
      {% block navbar %}{% include "_partials/_navbar.html" %}{% endblock %}

      <main class="kw-shell" role="main">
        {% block content %}{% endblock %}
      </main>

      {% block footer %}{% include "_partials/_footer.html" %}{% endblock %}

      <!-- CSRF auto-inject helper -->
      <script>
        (function() {
          const token = document.querySelector('meta[name="csrf-token"]')?.content || '';
          document.addEventListener('DOMContentLoaded', function() {
            document.querySelectorAll('form[method="post"]').forEach(f => {
              if (!f.querySelector('input[name="csrf_token"]') && token) {
                const i = document.createElement('input');
                i.type = 'hidden';
                i.name = 'csrf_token';
                i.value = token;
                f.appendChild(i);
              }
            });
          });
          const origFetch = window.fetch;
          window.fetch = function(i, init) {
            init = init || {};
            init.headers = new Headers(init.headers || {});
            if (token && !init.headers.has('X-CSRFToken')) init.headers.set('X-CSRFToken', token);
            return origFetch(i, init);
          };
        })();
      </script>

      <!-- ✅ Bootstrap and Chart.js -->
      <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
      <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

      {% block extra_js %}{% endblock %}
    </body>
    </html>
