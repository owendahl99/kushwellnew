{# templates/search/enterprise_search.html #}
{% extends "base.html" %}
{% block title %}Enterprise Search{% endblock %}

{% block content %}
<section class="mx-auto max-w-6xl p-4 md:p-6">
  <h1 class="text-2xl md:text-3xl font-bold text-gray-900 dark:text-gray-100 mb-4">
    Find Enterprises
  </h1>

  <form method="get" action="{{ url_for('search.enterprise_search') }}" class="grid gap-4 md:gap-6 grid-cols-1 md:grid-cols-4 bg-white dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded-2xl p-4 md:p-6">
    <div class="col-span-1 md:col-span-2">
      <label for="q" class="block text-lg font-medium text-gray-800 dark:text-gray-200">Name or Email</label>
      <input id="q" name="q" value="{{ q }}" type="text" autocomplete="off"
             class="mt-2 w-full rounded-xl border border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-800 px-4 py-3 text-lg"
             placeholder="e.g., GreenLeaf, care@greenleaf.com" />
    </div>

    <div>
      <label for="city" class="block text-lg font-medium text-gray-800 dark:text-gray-200">City</label>
      <input id="city" name="city" value="{{ city }}" type="text"
             class="mt-2 w-full rounded-xl border border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-800 px-4 py-3 text-lg" />
    </div>

    <div>
      <label for="state" class="block text-lg font-medium text-gray-800 dark:text-gray-200">State</label>
      <input id="state" name="state" value="{{ state }}" type="text"
             class="mt-2 w-full rounded-xl border border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-800 px-4 py-3 text-lg" />
    </div>

    <div>
      <label for="zip" class="block text-lg font-medium text-gray-800 dark:text-gray-200">ZIP</label>
      <input id="zip" name="zip" value="{{ zip_code }}" type="text"
             class="mt-2 w-full rounded-xl border border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-800 px-4 py-3 text-lg" />
    </div>

    <div>
      <label for="lat" class="block text-lg font-medium text-gray-800 dark:text-gray-200">Latitude</label>
      <input id="lat" name="lat" value="{{ lat if lat is not none else '' }}" type="number" step="any"
             class="mt-2 w-full rounded-xl border border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-800 px-4 py-3 text-lg" />
    </div>

    <div>
      <label for="lon" class="block text-lg font-medium text-gray-800 dark:text-gray-200">Longitude</label>
      <input id="lon" name="lon" value="{{ lon if lon is not none else '' }}" type="number" step="any"
             class="mt-2 w-full rounded-xl border border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-800 px-4 py-3 text-lg" />
    </div>

    <div>
      <label for="radius_km" class="block text-lg font-medium text-gray-800 dark:text-gray-200">Radius (km)</label>
      <input id="radius_km" name="radius_km" value="{{ radius_km if radius_km is not none else '' }}" type="number" step="any" min="0"
             class="mt-2 w-full rounded-xl border border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-800 px-4 py-3 text-lg" />
    </div>

    <div class="flex items-end">
      <button type="submit"
              class="w-full md:w-auto rounded-xl px-5 py-3 text-lg font-semibold bg-indigo-600 text-white hover:bg-indigo-700 focus:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:ring-indigo-500">
        Search
      </button>
    </div>
  </form>

  <div class="mt-4 md:mt-6" aria-live="polite">
    <p class="text-lg text-gray-700 dark:text-gray-300">{{ total }} result{{ 's' if total != 1 else '' }}</p>
  </div>

  <div class="mt-4 grid gap-4 md:gap-6 grid-cols-1 sm:grid-cols-2">
    {% for row in results %}
      {% set enterprise = namespace(
        name=row.name,
        logo_url=row.logo_url,
        phone=row.phone
      ) %}
      {% include "partials/enterprise_card.html" with context %}
      {# enterprise_card expects `enterprise` and `inventory_url` #}
    {% else %}
      <div class="col-span-full rounded-2xl border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-900 p-6">
        <p class="text-lg text-gray-700 dark:text-gray-300">No matches. Try widening your filters.</p>
      </div>
    {% endfor %}
  </div>
</section>
{% endblock %}



